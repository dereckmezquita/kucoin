---
title: "Getting started with kucoin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with kucoin}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
    warning = FALSE,
    message = FALSE,
    fig.path = "man/figures/README-",
    fig.align = "center",
    out.width = "100%",
    collapse = TRUE,
    comment = "#>"
)

options(
    "datatable.print.topn" = 3,
    "datatable.print.nrows" = 50,
    "datatable.print.class" = TRUE,
    "datatable.print.trunc.cols" = TRUE
)
```

## Introduction

The kucoin R package provides a convenient interface to interact with the kucoin cryptocurrency exchange API. This vignette will guide you through the basic usage of the package, demonstrating how to retrieve market data, place orders, and manage your account.

## Installation

You can install the kucoin package from GitHub using the `remotes` package:

```{r eval = FALSE}
remotes::install_github("dereckmezquita/kucoin")
```

## Setup

Before using the package, you need to set up your API credentials. Create a `.Renviron` file in your home directory and add your kucoin API key, secret, and passphrase:

```bash
KC-API-KEY=your_api_key
KC-API-SECRET=your_api_secret
KC-API-PASSPHRASE=your_api_passphrase
```

After setting up your credentials, load the package:

```{r}
box::use(kucoin)
box::use(dt = data.table)
```

## Retrieving Market Data

### Getting Market Metadata

To retrieve metadata for all available trading pairs:

```{r}
metadata <- kucoin$get_market_metadata()
head(metadata)
```

### Fetching Historical Market Data

To fetch historical price data for a specific trading pair:

```{r}
historical_data <- kucoin$get_market_data(
    symbols = "BTC/USDT",
    from = "2023-01-01 00:00:00",
    to = "2023-01-02 00:00:00",
    frequency = "1 hour"
)

head(historical_data)
```

## Account Management

### Checking Account Balances

To retrieve your account balances:

```{r eval = FALSE}
balances <- kucoin$get_account_balances()
head(balances)
```

### Getting Deposit Addresses

To get a deposit address for a specific currency:

```{r eval = FALSE}
deposit_address <- kucoin$get_deposit_address("BTC", "btc")
print(deposit_address)
```

## Trading

### Placing a Limit Order

To place a limit order:

```{r eval = FALSE}
order_id <- kucoin$submit_limit_order(
    symbol = "BTC/USDT",
    side = "buy",
    base_size = 0.001,
    price = 30000
)

print(order_id)
```

### Placing a Market Order

To place a market order:

```{r eval = FALSE}
order_id <- kucoin$submit_market_order(
    symbol = "ETH/USDT",
    side = "sell",
    base_size = 0.1
)

print(order_id)
```

### Checking Order Status

To check the status of an order:

```{r eval = FALSE}
order_details <- kucoin$get_orders_by_id("order_id_here")
print(order_details)
```

### Cancelling Orders

To cancel all open orders for a symbol:

```{r eval = FALSE}
cancelled_orders <- kucoin$cancel_all_orders("BTC/USDT")
print(cancelled_orders)
```

## Advanced Usage

### Working with Multiple Symbols

You can fetch data for multiple symbols at once:

```{r}
multi_symbol_data <- kucoin$get_market_data(
    symbols = c("BTC/USDT", "ETH/USDT", "XRP/USDT"),
    from = "2023-01-01 00:00:00",
    to = "2023-01-02 00:00:00",
    frequency = "1 hour"
)

# Analyse data using data.table
multi_symbol_data[, .(avg_price = mean(close)), by = symbol]

print(multi_symbol_data)
```

### Calculating Moving Averages

You can use the historical data to calculate moving averages. See my [github.com/dereckmezquita/dmplot](https://github.com/dereckmezquita/dmplot) package for data analysis and plotting functions written in high-performance C++.

```{r}
calculate_ma <- function(data, window) {
    data[, ma := dt$frollmean(close, n = window), by = symbol]
    return(data[])
}

btc_data <- kucoin$get_market_data(
    symbols = "BTC/USDT",
    from = "2023-01-01 00:00:00",
    to = "2023-01-31 00:00:00",
    frequency = "1 day"
)

btc_data_with_ma <- calculate_ma(btc_data, 7)
head(btc_data_with_ma)
```

## Conclusion

This vignette has covered the basic functionality of the kucoin R package. You can now retrieve market data, manage your account, and execute trades programmatically. Remember to handle API rate limits and errors appropriately in your applications.

For more detailed information on each function, refer to the package documentation using `?function_name` in the R console.
