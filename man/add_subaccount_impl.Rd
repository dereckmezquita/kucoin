% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/impl_account_sub_account.R
\name{add_subaccount_impl}
\alias{add_subaccount_impl}
\title{Add Sub-Account (Implementation)}
\usage{
add_subaccount_impl(
  keys = get_api_keys(),
  base_url = get_base_url(),
  password,
  subName,
  access,
  remarks = NULL,
  .__coro_env_parent__ = <environment>
)
}
\arguments{
\item{keys}{List containing API configuration parameters from \code{get_api_keys()}, including:
\itemize{
\item \code{api_key}: Character string; your KuCoin API key.
\item \code{api_secret}: Character string; your KuCoin API secret.
\item \code{api_passphrase}: Character string; your KuCoin API passphrase.
\item \code{key_version}: Character string; API key version (e.g., \code{"2"}).
Defaults to \code{get_api_keys()}.
}}

\item{base_url}{Character string representing the base URL for the API. Defaults to \code{get_base_url()}.}

\item{password}{Character string; sub-account password (7–24 characters, must contain both letters and numbers).}

\item{subName}{Character string; desired sub-account name (7–32 characters, must include at least one letter and one number, no spaces).}

\item{access}{Character string; permission type for the sub-account (allowed values: \code{"Spot"}, \code{"Futures"}, \code{"Margin"}).}

\item{remarks}{Character string (optional); remarks or notes about the sub-account (1–24 characters if provided).}
}
\value{
Promise resolving to a \code{data.table} containing sub-account details, including at least:
\itemize{
\item \code{uid} (integer): Unique identifier for the sub-account.
\item \code{subName} (character): Name of the sub-account.
\item \code{remarks} (character): Any provided remarks or notes.
\item \code{access} (character): Permission type granted to the sub-account.
}
}
\description{
Creates a new sub-account on KuCoin asynchronously by sending a POST request to the \verb{/api/v2/sub/user/created} endpoint. This internal function is designed for use within an R6 class and is not intended for direct end-user consumption.
}
\details{
\subsection{Workflow Overview}{
\enumerate{
\item \strong{URL Construction}: Retrieves the base URL using \code{get_base_url()} (or the user-supplied \code{base_url}) and appends the endpoint.
\item \strong{Request Body Preparation}: Creates a list with required parameters (\code{password}, \code{subName}, \code{access}, and optional \code{remarks}), converted to JSON format using \code{jsonlite::toJSON()} with \code{auto_unbox = TRUE}.
\item \strong{Header Preparation}: Generates authentication headers asynchronously via \code{build_headers()}, incorporating the signature, timestamp, encrypted passphrase, and API key details.
\item \strong{API Request}: Sends a POST request using \code{httr::POST()} with the constructed URL, headers, and JSON body, applying a 3-second timeout.
\item \strong{Response Handling}: Processes the JSON response with \code{process_kucoin_response()}, raising an error if the HTTP status is not 200 or the API code is not \code{"200000"}.
\item \strong{Result Conversion}: Converts the \code{data} field of the successful response into a \code{data.table}.
}
}

\subsection{API Endpoint}{

\verb{POST https://api.kucoin.com/api/v2/sub/user/created}
}

\subsection{Usage}{

Utilised internally to establish sub-accounts for managing separate trading permissions within the KuCoin ecosystem.
}

\subsection{Official Documentation}{

\href{https://www.kucoin.com/docs-new/rest/account-info/sub-account/add-subaccount}{KuCoin Add Sub-Account}

\strong{Raw Response Schema}:
\itemize{
\item \code{code} (string): Status code, where \code{"200000"} indicates success.
\item \code{data} (object): Contains the sub-account details as described above.
}

Example JSON response:

\if{html}{\out{<div class="sourceCode">}}\preformatted{\{
    "code": "200000",
    "data": \{
        "currentPage": 1,
        "pageSize": 10,
        "totalNum": 1,
        "totalPage": 1,
        "items": [
            \{
                "userId": "63743f07e0c5230001761d08",
                "uid": 169579801,
                "subName": "testapi6",
                "status": 2,
                "type": 0,
                "access": "All",
                "createdAt": 1668562696000,
                "remarks": "remarks",
                "tradeTypes": ["Spot", "Futures", "Margin"],
                "openedTradeTypes": ["Spot"],
                "hostedStatus": null
            \}
        ]
    \}
\}
}\if{html}{\out{</div>}}
}
}
\examples{
\dontrun{
keys <- get_api_keys()
base_url <- "https://api.kucoin.com"
main_async <- coro::async(function() {
  result <- await(add_subaccount_impl(
    keys = keys,
    base_url = base_url,
    password = "1234567",
    subName = "Name1234567",
    access = "Spot",
    remarks = "Test sub-account"
  ))
  print(result)
})
main_async()
while (!later::loop_empty()) later::run_now()
}
}
