% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/impl_account_deposit.R
\name{get_deposit_history_impl}
\alias{get_deposit_history_impl}
\title{Get Deposit History (Implementation)}
\usage{
get_deposit_history_impl(
  keys = get_api_keys(),
  base_url = get_base_url(),
  currency,
  status = NULL,
  startAt = NULL,
  endAt = NULL,
  page_size = 50,
  max_pages = Inf,
  .__coro_env_parent__ = <environment>
)
}
\arguments{
\item{keys}{List containing API configuration parameters from \code{get_api_keys()}, including:
\itemize{
\item \code{api_key}: Character string; your KuCoin API key.
\item \code{api_secret}: Character string; your KuCoin API secret.
\item \code{api_passphrase}: Character string; your KuCoin API passphrase.
\item \code{key_version}: Character string; API key version (e.g., \code{"2"}).
Defaults to \code{get_api_keys()}.
}}

\item{base_url}{Character string representing the base URL for the API. Defaults to \code{get_base_url()}.}

\item{currency}{Character string; the currency to filter deposits by (e.g., "BTC", "ETH", "USDT").}

\item{status}{Character string (optional); the status to filter by ("PROCESSING", "SUCCESS", "FAILURE"). If not provided, all statuses are included.}

\item{startAt}{Integer (optional); start time in milliseconds to filter deposits (e.g., 1728663338000).}

\item{endAt}{Integer (optional); end time in milliseconds to filter deposits (e.g., 1728692138000).}

\item{page_size}{Integer; number of results per page (minimum 10, maximum 500). Defaults to 50.}

\item{max_pages}{Numeric; maximum number of pages to fetch (defaults to \code{Inf}, fetching all available pages).}
}
\value{
Promise resolving to a \code{data.table} containing the deposit history, with columns including:
\itemize{
\item \code{currency} (character): The currency of the deposit (e.g., "USDT").
\item \code{chain} (character): The chain identifier (may be empty).
\item \code{status} (character): Deposit status ("PROCESSING", "SUCCESS", "FAILURE").
\item \code{address} (character): Deposit address or identifier.
\item \code{memo} (character): Address remark (may be empty).
\item \code{isInner} (logical): Whether the deposit is internal to KuCoin.
\item \code{amount} (character): Deposit amount.
\item \code{fee} (character): Fee charged for the deposit.
\item \code{walletTxId} (character or NULL): Wallet transaction ID (if applicable).
\item \code{createdAt} (integer): Creation timestamp in milliseconds.
\item \code{createdAtDatetime} (POSIXct): Converted creation datetime.
\item \code{updatedAt} (integer): Last updated timestamp in milliseconds.
\item \code{remark} (character): Additional remarks (may be empty).
\item \code{arrears} (logical): Whether the deposit is in arrears.
If no deposits are found, an empty \code{data.table} with these columns is returned.
}
}
\description{
Retrieves a paginated list of deposit history entries from KuCoin asynchronously by sending a GET request to the \verb{/api/v1/deposits} endpoint. This internal function is designed for use within an R6 class and is not intended for direct end-user consumption. Deposits are sorted to show the latest first, with pagination handled automatically.
}
\details{
\subsection{Workflow Overview}{
\enumerate{
\item \strong{URL Construction}: Combines the base URL with the endpoint \verb{/api/v1/deposits} and constructs query parameters using \code{build_query()}.
\item \strong{Pagination Initialisation}: Sets an initial query with \code{currentPage = 1} and the specified \code{page_size}, merging with additional filters.
\item \strong{Page Fetching}: Defines an asynchronous helper function (\code{fetch_page}) to send GET requests for each page, including authentication headers.
\item \strong{Automatic Pagination}: Leverages \code{auto_paginate} to fetch all pages up to \code{max_pages}, aggregating results into a single list.
\item \strong{Response Handling}: Processes responses with \code{process_kucoin_response()}, combines items into a \code{data.table} using \code{rbindlist()}, and adds a \code{createdAtDatetime} column for human-readable timestamps.
}
}

\subsection{API Endpoint}{

\verb{GET https://api.kucoin.com/api/v1/deposits}
}

\subsection{Usage}{

Utilised internally to fetch a comprehensive history of deposits for a KuCoin account, allowing filtering by currency, status, and time range.
}

\subsection{Official Documentation}{

\href{https://www.kucoin.com/docs-new/rest/account-info/deposit/get-deposit-history}{KuCoin Get Deposit History}
}
}
\examples{
\dontrun{
keys <- get_api_keys()
base_url <- "https://api.kucoin.com"
main_async <- coro::async(function() {
  dt <- await(get_deposit_history_impl(
    keys = keys,
    base_url = base_url,
    currency = "USDT",
    status = "SUCCESS",
    startAt = 1728663338000,
    endAt = 1728692138000,
    page_size = 50,
    max_pages = 2
  ))
  print(dt)
})
main_async()
while (!later::loop_empty()) later::run_now()
}
}
