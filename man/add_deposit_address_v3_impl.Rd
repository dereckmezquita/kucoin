% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/impl_account_deposit.R
\name{add_deposit_address_v3_impl}
\alias{add_deposit_address_v3_impl}
\title{Add Deposit Address (V3) (Implementation)}
\usage{
add_deposit_address_v3_impl(
  keys = get_api_keys(),
  base_url = get_base_url(),
  currency,
  chain = NULL,
  to = NULL,
  amount = NULL,
  .__coro_env_parent__ = <environment>
)
}
\arguments{
\item{keys}{List containing API configuration parameters from \code{get_api_keys()}, including:
\itemize{
\item \code{api_key}: Character string; your KuCoin API key.
\item \code{api_secret}: Character string; your KuCoin API secret.
\item \code{api_passphrase}: Character string; your KuCoin API passphrase.
\item \code{key_version}: Character string; API key version (e.g., \code{"2"}).
Defaults to \code{get_api_keys()}.
}}

\item{base_url}{Character string representing the base URL for the API. Defaults to \code{get_base_url()}.}

\item{currency}{Character string; the currency for which to create the deposit address (e.g., "BTC", "ETH", "USDT").}

\item{chain}{Character string (optional); the chain identifier (e.g., "eth", "bech32", "btc"). If not provided, the API uses the default chain for the currency.}

\item{to}{Character string (optional); the account type to deposit to ("main" or "trade"). If not provided, defaults to "main".}

\item{amount}{Character string (optional); the deposit amount, only used for Lightning Network invoices.}
}
\value{
Promise resolving to a \code{data.table} containing the deposit address details, including:
\itemize{
\item \code{address} (character): The deposit address.
\item \code{memo} (character): Address remark (may be empty).
\item \code{chainId} (character): The chain identifier.
\item \code{to} (character): The account type.
\item \code{expirationDate} (integer): Expiration time (for Lightning Network).
\item \code{currency} (character): The currency.
\item \code{chainName} (character): The chain name.
}
}
\description{
Creates a new deposit address for a specified currency on KuCoin asynchronously by sending a POST request to the \verb{/api/v3/deposit-address/create} endpoint. This internal function is designed for use within an R6 class and is not intended for direct end-user consumption.
}
\details{
\subsection{Workflow Overview}{
\enumerate{
\item \strong{URL Construction}: Combines the base URL with the endpoint \verb{/api/v3/deposit-address/create}.
\item \strong{Request Body Preparation}: Creates a list with required and optional parameters (\code{currency}, \code{chain}, \code{to}, \code{amount}), converted to JSON.
\item \strong{Header Preparation}: Generates authentication headers asynchronously via \code{build_headers()}.
\item \strong{API Request}: Sends a POST request using \code{httr::POST()} with the constructed URL, headers, and JSON body, applying a 3-second timeout.
\item \strong{Response Handling}: Processes the JSON response with \code{process_kucoin_response()}, extracting the \code{"data"} field and converting it to a \code{data.table}.
}
}

\subsection{API Endpoint}{

\verb{POST https://api.kucoin.com/api/v3/deposit-address/create}
}

\subsection{Usage}{

Utilised internally to create deposit addresses for various currencies, enabling deposits to the specified account type.
}

\subsection{Official Documentation}{

\href{https://www.kucoin.com/docs-new/rest/account-info/deposit/add-deposit-address-v3}{KuCoin Add Deposit Address (V3)}
}
}
\examples{
\dontrun{
keys <- get_api_keys()
base_url <- "https://api.kucoin.com"
main_async <- coro::async(function() {
  dt <- await(add_deposit_address_v3_impl(
    keys = keys,
    base_url = base_url,
    currency = "TON",
    chain = "ton",
    to = "trade"
  ))
  print(dt)
})
main_async()
while (!later::loop_empty()) later::run_now()
}
}
